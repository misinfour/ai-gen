# 图片路径更新总结

## 更新内容

根据用户需求，已成功修改图片存储和URL生成逻辑，现在图片路径包含游戏名称。

## 主要变更

### 1. 配置文件更新

**路径模板更新：**
```json
// 原路径模板
"path_template": "{base_path}/{year}/{month}/{day}"

// 新路径模板
"path_template": "{base_path}/{year}/{month}/{day}/{game_title}"
```

### 2. 路径生成逻辑更新

**新的路径结构：**
```
images/年/月/日/游戏标题/
```

**示例路径：**
```
images/2025/10/18/神魔之塔新手攻略/
```

### 3. 远程URL生成

**URL格式：**
```
https://images.domain.com/images/年/月/日/游戏标题/文件名
```

**示例URL：**
```
https://images.5yxy5.com/images/2025/10/18/神魔之塔新手攻略/image_0_1758967972.jpg
```

## 功能验证

### 测试结果

✅ 路径生成功能正常
✅ 游戏标题正确包含在路径中
✅ 远程URL格式正确
✅ 图片路径替换功能正常

### 测试输出示例

```
路径生成测试:
  repo1: images/2025/10/18/神魔之塔新手攻略
    示例URL: https://images.5yxy5.com/images/2025/10/18/神魔之塔新手攻略/image_0_1758967972.jpg

图片路径替换测试:
原始内容:
![游戏截图](./images/image_0_1758967972.jpg)

更新后内容:
![游戏截图](https://images.5yxy5.com/images/2025/10/18/神魔之塔新手攻略/image_0_1758967972.jpg)
```

## 技术实现

### 1. 路径模板变量

支持以下变量：
- `{base_path}`: 基础路径
- `{year}`: 年份
- `{month}`: 月份
- `{day}`: 日期
- `{game_title}`: 游戏标题（从文章folder_name获取）

### 2. 代码修改

**image_upload_manager.py:**
- 更新 `generate_image_target_path()` 方法
- 添加 `game_title` 变量支持
- 使用文章文件夹名称作为游戏标题

**config.json:**
- 更新所有图床仓库的路径模板
- 添加 `{game_title}` 变量支持

## 使用效果

### 图片存储结构

```
图床仓库/
├── images/
│   ├── 2025/
│   │   ├── 10/
│   │   │   ├── 18/
│   │   │   │   ├── 神魔之塔新手攻略/
│   │   │   │   │   ├── image_0_1758967972.jpg
│   │   │   │   │   └── character_1_1758967973.png
│   │   │   │   └── 其他游戏标题/
│   │   │   └── 19/
│   │   └── 11/
│   └── 2026/
```

### 文章中的图片引用

**原始格式：**
```markdown
![游戏截图](./images/image_0_1758967972.jpg)
```

**更新后格式：**
```markdown
![游戏截图](https://images.5yxy5.com/images/2025/10/18/神魔之塔新手攻略/image_0_1758967972.jpg)
```

## 优势

1. **组织性更好**：图片按游戏标题分类存储
2. **易于管理**：每个游戏的图片独立存储
3. **URL语义化**：URL路径包含游戏信息
4. **避免冲突**：不同游戏的图片不会冲突
5. **便于维护**：可以按游戏删除或管理图片

## 注意事项

1. **游戏标题来源**：使用文章的 `folder_name` 作为游戏标题
2. **路径长度**：确保游戏标题不会导致路径过长
3. **特殊字符**：游戏标题中的特殊字符会被保留在URL中
4. **兼容性**：现有的图片上传和替换功能完全兼容

## 测试文件

- `test_image_path.py`: 路径生成和替换功能测试
- 测试通过，功能正常

## 总结

成功实现了包含游戏标题的图片路径结构，满足了用户的需求。现在图片会按照 `images/年/月/日/游戏标题/` 的结构存储，远程URL也包含完整的路径信息，便于管理和访问。
