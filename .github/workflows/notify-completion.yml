name: å…³é”®è¯å¤„ç†å®Œæˆé€šçŸ¥

on:
  workflow_run:
    workflows: ["å…³é”®è¯æ–‡ç« æ ‡é¢˜å¤„ç†å·¥ä½œæµ", "å…³é”®è¯å¤„ç†é‡è¯•å·¥ä½œæµ"]
    types: [completed]

jobs:
  notify-completion:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'skipped' }}
    
    steps:
    - name: æ£€æŸ¥å·¥ä½œæµç»“æœ
      id: check-workflow
      run: |
        WORKFLOW_NAME="${{ github.event.workflow_run.name }}"
        CONCLUSION="${{ github.event.workflow_run.conclusion }}"
        RUN_ID="${{ github.event.workflow_run.id }}"
        
        echo "å·¥ä½œæµåç§°: $WORKFLOW_NAME"
        echo "æ‰§è¡Œç»“æœ: $CONCLUSION"
        echo "è¿è¡ŒID: $RUN_ID"
        
        echo "workflow_name=$WORKFLOW_NAME" >> $GITHUB_OUTPUT
        echo "conclusion=$CONCLUSION" >> $GITHUB_OUTPUT
        echo "run_id=$RUN_ID" >> $GITHUB_OUTPUT
        
    - name: å‘é€æˆåŠŸé€šçŸ¥
      if: steps.check-workflow.outputs.conclusion == 'success'
      run: |
        echo "ğŸ‰ å…³é”®è¯å¤„ç†å·¥ä½œæµæ‰§è¡ŒæˆåŠŸï¼"
        echo "å·¥ä½œæµ: ${{ steps.check-workflow.outputs.workflow_name }}"
        echo "è¿è¡ŒID: ${{ steps.check-workflow.outputs.run_id }}"
        echo "å®Œæˆæ—¶é—´: $(date)"
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šé€šçŸ¥æ–¹å¼ï¼Œæ¯”å¦‚ï¼š
        # - å‘é€é‚®ä»¶
        # - å‘é€Slackæ¶ˆæ¯
        # - å‘é€é’‰é’‰æ¶ˆæ¯
        # - å‘é€å¾®ä¿¡æ¶ˆæ¯
        
    - name: å‘é€å¤±è´¥é€šçŸ¥
      if: steps.check-workflow.outputs.conclusion == 'failure'
      run: |
        echo "âŒ å…³é”®è¯å¤„ç†å·¥ä½œæµæ‰§è¡Œå¤±è´¥ï¼"
        echo "å·¥ä½œæµ: ${{ steps.check-workflow.outputs.workflow_name }}"
        echo "è¿è¡ŒID: ${{ steps.check-workflow.outputs.run_id }}"
        echo "å¤±è´¥æ—¶é—´: $(date)"
        
        # è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šé€šçŸ¥æ–¹å¼
        
    - name: å‘é€å–æ¶ˆé€šçŸ¥
      if: steps.check-workflow.outputs.conclusion == 'cancelled'
      run: |
        echo "âš ï¸ å…³é”®è¯å¤„ç†å·¥ä½œæµè¢«å–æ¶ˆï¼"
        echo "å·¥ä½œæµ: ${{ steps.check-workflow.outputs.workflow_name }}"
        echo "è¿è¡ŒID: ${{ steps.check-workflow.outputs.run_id }}"
        echo "å–æ¶ˆæ—¶é—´: $(date)"
        
    - name: å‘é€è¶…æ—¶é€šçŸ¥
      if: steps.check-workflow.outputs.conclusion == 'timed_out'
      run: |
        echo "â° å…³é”®è¯å¤„ç†å·¥ä½œæµæ‰§è¡Œè¶…æ—¶ï¼"
        echo "å·¥ä½œæµ: ${{ steps.check-workflow.outputs.workflow_name }}"
        echo "è¿è¡ŒID: ${{ steps.check-workflow.outputs.run_id }}"
        echo "è¶…æ—¶æ—¶é—´: $(date)"
