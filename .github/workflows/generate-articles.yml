name: æ–‡ç« ç”Ÿæˆå·¥ä½œæµ

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´1ç‚¹æ‰§è¡Œ (UTCæ—¶é—´17ç‚¹)
    # æ¯æ—¥å‘å¸ƒæ¨¡å¼ï¼šéšæœºåˆ†é…æ–‡ç« åˆ°å„ä¸ªç½‘ç«™
    - cron: '30 20 20 10 *'
  workflow_dispatch:
    inputs:
      need_images:
        description: 'æ˜¯å¦éœ€è¦ä¸‹è½½å›¾ç‰‡'
        required: false
        type: boolean
        default: true
      articles_per_site:
        description: 'æ¯ä¸ªç½‘ç«™å‘å¸ƒæ–‡ç« æ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨é…ç½®æ–‡ä»¶è®¾ç½®ï¼‰'
        required: false
        type: string
      max_workers:
        description: 'å¹¶è¡Œç”Ÿæˆçº¿ç¨‹æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤6ä¸ªï¼‰'
        required: false
        type: string
        default: '6'
      batch_size:
        description: 'æ‰¹å¤„ç†å¤§å°ï¼ˆå¯é€‰ï¼Œé»˜è®¤6ä¸ª[æŒ‡è¶³å¤Ÿ6ç¯‡æ‰æäº¤]ï¼‰'
        required: false
        type: string
        default: '6'

jobs:
  generate-articles:
    runs-on: ubuntu-latest
    timeout-minutes: 120  # è®¾ç½®2å°æ—¶è¶…æ—¶
    permissions:
      contents: write
      pull-requests: write
      actions: write
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        persist-credentials: true
        token: ${{ secrets.GH_PAT }}  # ç›´æ¥ä½¿ç”¨ PATï¼Œå»æ‰å›é€€é€»è¾‘
      
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ä»è¿œç¨‹è·å–é…ç½®æ–‡ä»¶
      run: |
        echo "ğŸ“¥ æ­£åœ¨ä»è¿œç¨‹è·å–é…ç½®æ–‡ä»¶..."
        curl -s "https://eternity.misinguo.com/ai-gen/config.json" -o config.json
        
        # æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–é…ç½®æ–‡ä»¶
        if [ -f "config.json" ] && [ -s "config.json" ]; then
          echo "âœ… æˆåŠŸè·å–è¿œç¨‹é…ç½®æ–‡ä»¶"
          echo "ğŸ“Š é…ç½®æ–‡ä»¶å¤§å°: $(wc -c < config.json) å­—èŠ‚"
        else
          echo "âŒ è·å–è¿œç¨‹é…ç½®æ–‡ä»¶å¤±è´¥"
          exit 1
        fi
        
    - name: åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆå¤‡ç”¨ï¼‰
      run: |
        # åªæœ‰åœ¨config.jsonä¸å­˜åœ¨æ—¶æ‰åˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼‰
        if [ ! -f "config.json" ]; then
          echo "âš ï¸ config.jsonä¸å­˜åœ¨ï¼Œä½¿ç”¨å¤‡ç”¨é…ç½®æ–‡ä»¶..."
          cat > config.json << EOF
        {
          "default_platform": "groq",
          "platforms": {
            "groq": {
              "name": "Groq",
              "base_url": "https://api.groq.com/openai/v1/chat/completions",
              "proxy_url": "https://m3u8-player.5yxy5.com/api/forward/https://api.groq.com/openai/v1/chat/completions",
              "models": {
                "default": "deepseek-r1-distill-llama-70b",
                "available": [
                  "deepseek-r1-distill-llama-70b",
                  "llama-3.1-70b-versatile",
                  "llama-3.1-8b-instant",
                  "mixtral-8x7b-32768"
                ]
              },
              "api_keys": [
                "${{ secrets.GROQ_API_KEY_1 }}",
                "${{ secrets.GROQ_API_KEY_2 }}",
                "${{ secrets.GROQ_API_KEY_3 }}",
                "${{ secrets.GROQ_API_KEY_4 }}",
                "${{ secrets.GROQ_API_KEY_5 }}",
                "${{ secrets.GROQ_API_KEY_6 }}"
              ],
              "headers": {
                "Content-Type": "application/json"
              },
              "auth_type": "bearer",
              "timeout": 60,
              "max_retries": 20
            },
            "openai": {
              "name": "OpenAI",
              "base_url": "https://api.openai.com/v1/chat/completions",
              "proxy_url": "https://m3u8-player.5yxy5.com/api/forward/https://api.openai.com/v1/chat/completions",
              "models": {
                "default": "gpt-3.5-turbo",
                "available": [
                  "gpt-3.5-turbo",
                  "gpt-3.5-turbo-16k",
                  "gpt-4",
                  "gpt-4-turbo",
                  "gpt-4o",
                  "gpt-4o-mini"
                ]
              },
              "api_keys": [
                "${{ secrets.OPENAI_API_KEY }}"
              ],
              "headers": {
                "Content-Type": "application/json"
              },
              "auth_type": "bearer",
              "timeout": 60,
              "max_retries": 20
            },
            "gemini": {
              "name": "Google Gemini",
              "base_url": "https://generativelanguage.googleapis.com/v1beta/models",
              "proxy_url": "https://m3u8-player.5yxy5.com/api/forward/https://generativelanguage.googleapis.com/v1beta/models",
              "models": {
                "default": "gemini-1.5-flash",
                "available": [
                  "gemini-1.5-flash",
                  "gemini-1.5-pro",
                  "gemini-1.0-pro"
                ]
              },
              "api_keys": [
                "${{ secrets.GEMINI_API_KEY }}"
              ],
              "headers": {
                "Content-Type": "application/json"
              },
              "auth_type": "api_key",
              "timeout": 60,
              "max_retries": 20
            },
            "claude": {
              "name": "Anthropic Claude",
              "base_url": "https://api.anthropic.com/v1/messages",
              "proxy_url": "https://m3u8-player.5yxy5.com/api/forward/https://api.anthropic.com/v1/messages",
              "models": {
                "default": "claude-3-sonnet-20240229",
                "available": [
                  "claude-3-sonnet-20240229",
                  "claude-3-opus-20240229",
                  "claude-3-haiku-20240307"
                ]
              },
              "api_keys": [
                "${{ secrets.CLAUDE_API_KEY }}"
              ],
              "headers": {
                "Content-Type": "application/json",
                "anthropic-version": "2023-06-01"
              },
              "auth_type": "x-api-key",
              "timeout": 60,
              "max_retries": 20
            }
          },
          "settings": {
            "use_proxy": true,
            "temperature": 0.6,
            "max_tokens": 10000,
            "top_p": 0.95,
            "stream": false
          },
          "kv_storage": {
            "account_id": "${{ secrets.CLOUDFLARE_ACCOUNT_ID }}",
            "namespace_id": "${{ secrets.CLOUDFLARE_NAMESPACE_ID }}",
            "api_token": "${{ secrets.CLOUDFLARE_API_TOKEN }}"
          },
          "prompts": {
            "zh-cn": {
              "name": "ç®€ä½“ä¸­æ–‡æç¤ºè¯",
              "template": "${{ secrets.ZH_CN_PROMPT_TEMPLATE }}"
            },
            "zh-tw": {
              "name": "ç¹é«”ä¸­æ–‡æç¤ºè©",
              "template": "${{ secrets.ZH_TW_PROMPT_TEMPLATE }}"
            }
          },
          "google_seo_article_title_prompt": {
            "zh-cn": {
              "name": "ç®€ä½“ä¸­æ–‡æç¤ºè¯",
              "template": "${{ secrets.GOOGLE_SEO_ARTICLE_TITLE_PROMPT_ZH_CN }}"
            },
            "zh-tw": {
              "name": "ç¹é«”ä¸­æ–‡æç¤ºè©",
              "template": "${{ secrets.GOOGLE_SEO_ARTICLE_TITLE_PROMPT_ZH_TW }}"
            }
          }
        }
        EOF
        else
          echo "config.jsonå·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»ºé…ç½®æ–‡ä»¶"
        fi
        
    - name: åˆ›å»ºå¿…è¦çš„ç›®å½•
      run: |
        # è·å–å½“å‰æ—¥æœŸï¼ˆä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼‰
        # è®¾ç½®æ—¶åŒºä¸ºåŒ—äº¬æ—¶é—´
        export TZ='Asia/Shanghai'
        YEAR=$(date +%Y)
        MONTH=$(date +%m)
        DAY=$(date +%d)
        
        # åˆ›å»ºæŒ‰æ—¥æœŸç»„ç»‡çš„ç›®å½•ç»“æ„
        mkdir -p logs/$YEAR/$MONTH/$DAY/zh-cn
        mkdir -p logs/$YEAR/$MONTH/$DAY/zh-tw
        mkdir -p logs/$YEAR/$MONTH/$DAY/images
        
        echo "ğŸ“ åˆ›å»ºç›®å½•ç»“æ„: logs/$YEAR/$MONTH/$DAY/ (åŒ—äº¬æ—¶é—´)"
        
    - name: æ£€æŸ¥é…ç½®æ–‡ä»¶
      run: |
        if [ ! -f "config.json" ]; then
          echo "âŒ é…ç½®æ–‡ä»¶ config.json ä¸å­˜åœ¨"
          exit 1
        fi
        echo "âœ… é…ç½®æ–‡ä»¶å­˜åœ¨"
        
    - name: æ£€æŸ¥é•¿å°¾è¯æ–‡ä»¶
      run: |
        if [ ! -f "é•¿å°¾è¯.txt" ]; then
          echo "âŒ é•¿å°¾è¯æ–‡ä»¶ é•¿å°¾è¯.txt ä¸å­˜åœ¨"
          exit 1
        fi
        echo "âœ… é•¿å°¾è¯æ–‡ä»¶å­˜åœ¨"
        
    - name: è¿è¡Œæ–‡ç« ç”Ÿæˆä»»åŠ¡
      id: generate-task
      run: |
        # è®¾ç½®ç¯å¢ƒå˜é‡
        export PYTHONUNBUFFERED=1
        # è®°å½•å¼€å§‹æ—¶é—´ä¸è¶…æ—¶é˜ˆå€¼ï¼Œç”¨äºåŒºåˆ†è¶…æ—¶ vs æ‰‹åŠ¨å–æ¶ˆ
        START_TS=$(date +%s)
        TIMEOUT_MINUTES=120
        # åœ¨æ¥æ”¶åˆ°ç»ˆæ­¢ä¿¡å·æ—¶è¿›è¡Œåˆ¤æ–­ï¼šæ¥è¿‘è¶…æ—¶æ—¶è®¤ä¸ºæ˜¯è¶…æ—¶å–æ¶ˆï¼Œå¦åˆ™è®¤ä¸ºæ˜¯æ‰‹åŠ¨å–æ¶ˆ
        trap 'NOW=$(date +%s); ELAPSED=$(( NOW - START_TS )); THRESH=$(( TIMEOUT_MINUTES*60 - 300 )); echo "âš ï¸ æ”¶åˆ°ç»ˆæ­¢ä¿¡å·ï¼Œå·²è¿è¡Œ ${ELAPSED}sï¼Œé˜ˆå€¼ ${THRESH}s"; if [ "$ELAPSED" -ge "$THRESH" ]; then echo "â° æ¨æµ‹ä¸ºæ¥è¿‘è¶…æ—¶å¯¼è‡´çš„å–æ¶ˆï¼Œæ ‡è®°ä¸ºéœ€é‡è¯•"; printf "{\"status\":\"timeout\",\"timestamp\":\"%s\"}\n" "$(date -Iseconds)" > generate_result.json; touch .timeout_inferred; else echo "ğŸ›‘ æ¨æµ‹ä¸ºæ‰‹åŠ¨å–æ¶ˆï¼Œä¸é‡è¯•"; printf "{\"status\":\"cancelled\",\"timestamp\":\"%s\"}\n" "$(date -Iseconds)" > generate_result.json; fi; exit 1' SIGTERM SIGINT
        
        # è·å–å¤„ç†å‚æ•°
        NEED_IMAGES="${{ github.event.inputs.need_images || 'true' }}"
        ARTICLES_PER_SITE="${{ github.event.inputs.articles_per_site }}"
        MAX_WORKERS="${{ github.event.inputs.max_workers || '6' }}"
        BATCH_SIZE="${{ github.event.inputs.batch_size || '6' }}"
        
        echo "ğŸš€ å¼€å§‹æ‰§è¡Œæ–‡ç« ç”Ÿæˆä»»åŠ¡..."
        echo "éœ€è¦å›¾ç‰‡: ${NEED_IMAGES}"
        echo "æ¯ç«™æ–‡ç« æ•°: ${ARTICLES_PER_SITE:-'ä½¿ç”¨é»˜è®¤å€¼'}"
        echo "å¹¶è¡Œçº¿ç¨‹æ•°: ${MAX_WORKERS}"
        echo "æ‰¹å¤„ç†å¤§å°: ${BATCH_SIZE}"
        echo "è§¦å‘æ–¹å¼: ${{ github.event_name }}"
        echo "è¿è¡Œæ—¶é—´: $(date)"
        
        # è¿è¡Œæ–‡ç« ç”Ÿæˆè„šæœ¬
        python -c "
        import sys
        sys.path.append('.')
        
        # å¯¼å…¥å¿…è¦çš„æ¨¡å—
        from process_articles import daily_publish_articles
        import json
        from datetime import datetime
        
        try:
            # è§£æå‚æ•°
            need_images = '$NEED_IMAGES'
            articles_per_site = '$ARTICLES_PER_SITE'
            max_workers = '$MAX_WORKERS'
            batch_size = '$BATCH_SIZE'
            
            # è½¬æ¢å‚æ•°ç±»å‹
            need_images_bool = need_images.lower() == 'true' if need_images else True
            articles_per_site_int = None
            max_workers_int = None
            batch_size_int = None
            
            if articles_per_site and articles_per_site.strip():
                try:
                    articles_per_site_int = int(articles_per_site)
                    print(f'è§£æåˆ° articles_per_site: {articles_per_site_int}')
                except ValueError:
                    print(f'è­¦å‘Š: æ— æ³•å°† {articles_per_site} è½¬æ¢ä¸ºæ•´æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼ None')
            
            if max_workers and max_workers.strip():
                try:
                    max_workers_int = int(max_workers)
                    print(f'è§£æåˆ° max_workers: {max_workers_int}')
                except ValueError:
                    print(f'è­¦å‘Š: æ— æ³•å°† {max_workers} è½¬æ¢ä¸ºæ•´æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼ None')
            
            if batch_size and batch_size.strip():
                try:
                    batch_size_int = int(batch_size)
                    print(f'è§£æåˆ° batch_size: {batch_size_int}')
                except ValueError:
                    print(f'è­¦å‘Š: æ— æ³•å°† {batch_size} è½¬æ¢ä¸ºæ•´æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼ None')
            
            print('ğŸ“… ä½¿ç”¨æ¯æ—¥å‘å¸ƒæ¨¡å¼ï¼šéšæœºæŠ½å–å¯å‘å¸ƒæ ‡é¢˜å¹¶éšæœºåˆ†é…åˆ°ç½‘ç«™')
            print(f'ğŸ“Š å‘å¸ƒç­–ç•¥ï¼šéœ€è¦ä¸‹è½½å›¾ç‰‡={need_images_bool}')
            if articles_per_site_int:
                print(f'ğŸ“Š å‘å¸ƒç­–ç•¥ï¼šæ¯ä¸ªç½‘ç«™å‘å¸ƒ {articles_per_site_int} ç¯‡æ–‡ç« ï¼ˆä½¿ç”¨å·¥ä½œæµæŒ‡å®šæ•°é‡ï¼‰')
            else:
                print('ğŸ“Š å‘å¸ƒç­–ç•¥ï¼šæ¯ä¸ªç½‘ç«™å‘å¸ƒé»˜è®¤æ•°é‡ï¼ˆå‚è€ƒé…ç½®æ–‡ä»¶ï¼‰')
            
            if max_workers_int:
                print(f'ğŸ”§ å¹¶è¡Œé…ç½®ï¼šä½¿ç”¨ {max_workers_int} ä¸ªçº¿ç¨‹ï¼ˆå·¥ä½œæµæŒ‡å®šï¼‰')
            else:
                print('ğŸ”§ å¹¶è¡Œé…ç½®ï¼šä½¿ç”¨é»˜è®¤çº¿ç¨‹æ•°ï¼ˆå‚è€ƒé…ç½®æ–‡ä»¶ï¼‰')
                
            if batch_size_int:
                print(f'ğŸ”§ å¹¶è¡Œé…ç½®ï¼šæ‰¹å¤„ç†å¤§å° {batch_size_int}ï¼ˆå·¥ä½œæµæŒ‡å®šï¼‰')
            else:
                print('ğŸ”§ å¹¶è¡Œé…ç½®ï¼šä½¿ç”¨é»˜è®¤æ‰¹å¤„ç†å¤§å°ï¼ˆå‚è€ƒé…ç½®æ–‡ä»¶ï¼‰')
            
            # è¿è¡Œæ¯æ—¥å‘å¸ƒ
            result = daily_publish_articles(
                need_images=need_images_bool, 
                articles_per_site=articles_per_site_int,
                max_workers=max_workers_int,
                batch_size=batch_size_int
            )
            
            if result is True:
                print('âœ… æ–‡ç« ç”Ÿæˆå®Œæˆ')
                
                # è®¾ç½®æˆåŠŸçŠ¶æ€
                with open('generate_result.json', 'w', encoding='utf-8') as f:
                    json.dump({
                        'status': 'success',
                        'timestamp': datetime.now().isoformat(),
                        'need_images': need_images_bool,
                        'articles_per_site': articles_per_site_int
                    }, f, ensure_ascii=False, indent=2)
            elif result == 'circuit_breaker':
                print('âš ï¸ æ–‡ç« ç”Ÿæˆè§¦å‘ç†”æ–­æœºåˆ¶ï¼ˆAPIæœåŠ¡å¼‚å¸¸ï¼‰')
                
                # ç†”æ–­çŠ¶æ€
                with open('generate_result.json', 'w', encoding='utf-8') as f:
                    json.dump({
                        'status': 'circuit_breaker',
                        'message': 'æ–‡ç« ç”Ÿæˆè§¦å‘ç†”æ–­æœºåˆ¶ï¼ŒAPIæœåŠ¡å¼‚å¸¸ï¼Œéœ€è¦ç­‰å¾…åé‡è¯•',
                        'timestamp': datetime.now().isoformat(),
                        'need_images': need_images_bool,
                        'articles_per_site': articles_per_site_int
                    }, f, ensure_ascii=False, indent=2)
                
                # æŠ›å‡ºå¼‚å¸¸ä»¥è§¦å‘é‡è¯•æ¨¡å¼
                raise Exception('æ–‡ç« ç”Ÿæˆè§¦å‘ç†”æ–­æœºåˆ¶ï¼Œéœ€è¦ç­‰å¾…åé‡è¯•')
            else:
                print('âš ï¸ æ–‡ç« ç”Ÿæˆå¤±è´¥')
                
                # è®¾ç½®å¤±è´¥çŠ¶æ€
                with open('generate_result.json', 'w', encoding='utf-8') as f:
                    json.dump({
                        'status': 'error',
                        'error': 'æ–‡ç« ç”Ÿæˆå¤±è´¥',
                        'timestamp': datetime.now().isoformat(),
                        'need_images': need_images_bool,
                        'articles_per_site': articles_per_site_int
                    }, f, ensure_ascii=False, indent=2)
                
                # æŠ›å‡ºå¼‚å¸¸ä»¥è§¦å‘é‡è¯•
                raise Exception('æ–‡ç« ç”Ÿæˆå¤±è´¥')
                
        except Exception as e:
            print(f'âŒ æ–‡ç« ç”Ÿæˆå¤±è´¥: {str(e)}')
            
            # æ£€æŸ¥æ˜¯å¦æ˜¯ç†”æ–­ç›¸å…³çš„å¼‚å¸¸
            error_str = str(e)
            # æ‰©å±•ç†”æ–­æ£€æµ‹æ¡ä»¶ï¼ŒåŒ…æ‹¬æ›´å¤šç½‘ç»œå’ŒAPIæœåŠ¡å¼‚å¸¸
            circuit_breaker_keywords = [
                'ç†”æ–­æœºåˆ¶', 'HTTPé”™è¯¯ 500', 'ApiExhaustedRetriesError',
                'Internal Server Error', 'Server Error', '500 Server Error',
                'internal server error', 'Connection timeout', 'Read timeout',
                'Connection error', 'Network error', 'Service unavailable',
                'Bad Gateway', 'Gateway Timeout', 'HTTPé”™è¯¯ 502', 'HTTPé”™è¯¯ 503', 'HTTPé”™è¯¯ 504',
                'æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥äº†', 'è¿ç»­å¤±è´¥', 'APIæœåŠ¡å¼‚å¸¸', 'chat_completion',
                'APIé‡è¯•è€—å°½å¼‚å¸¸', 'APIæœåŠ¡è¿ç»­å¤±è´¥', 'è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°', 'ğŸ”¥', 'â›”',
                'æ‰€æœ‰APIå¯†é’¥éƒ½å¤±è´¥', 'é‡è¯•è¶…è¿‡ä¸Šé™'
            ]
            
            is_circuit_breaker = any(keyword in error_str for keyword in circuit_breaker_keywords)
            
            if is_circuit_breaker:
                # è®¾ç½®ç†”æ–­çŠ¶æ€
                with open('generate_result.json', 'w', encoding='utf-8') as f:
                    json.dump({
                        'status': 'circuit_breaker',
                        'message': 'æ–‡ç« ç”Ÿæˆè§¦å‘ç†”æ–­æœºåˆ¶ï¼ŒAPIæœåŠ¡å¼‚å¸¸ï¼Œéœ€è¦ç­‰å¾…åé‡è¯•',
                        'error': error_str,
                        'timestamp': datetime.now().isoformat(),
                        'need_images': need_images,
                        'articles_per_site': articles_per_site
                    }, f, ensure_ascii=False, indent=2)
            else:
                # è®¾ç½®æ™®é€šå¤±è´¥çŠ¶æ€
                with open('generate_result.json', 'w', encoding='utf-8') as f:
                    json.dump({
                        'status': 'error',
                        'error': error_str,
                        'timestamp': datetime.now().isoformat(),
                        'need_images': need_images,
                        'articles_per_site': articles_per_site
                    }, f, ensure_ascii=False, indent=2)
            
            # é‡æ–°æŠ›å‡ºå¼‚å¸¸ä»¥è§¦å‘é‡è¯•
            raise
        "
        
    - name: æ£€æŸ¥å¤„ç†ç»“æœ
      id: check-result
      if: always()
      run: |
        if [ -f "generate_result.json" ]; then
          STATUS=$(python -c "import json; data=json.load(open('generate_result.json')); print(data['status'])")
          echo "å¤„ç†çŠ¶æ€: $STATUS"
          echo "status=$STATUS" >> $GITHUB_OUTPUT
          
          if [ "$STATUS" = "error" ]; then
            ERROR_MSG=$(python -c "import json; data=json.load(open('generate_result.json')); print(data.get('error', 'Unknown error'))")
            echo "é”™è¯¯ä¿¡æ¯: $ERROR_MSG"
            echo "error_message=$ERROR_MSG" >> $GITHUB_OUTPUT
          elif [ "$STATUS" = "circuit_breaker" ]; then
            CIRCUIT_MSG=$(python -c "import json; data=json.load(open('generate_result.json')); print(data.get('message', 'Circuit breaker triggered'))")
            echo "ç†”æ–­ä¿¡æ¯: $CIRCUIT_MSG"
            echo "error_message=$CIRCUIT_MSG" >> $GITHUB_OUTPUT
          fi
        else
          echo "æœªæ‰¾åˆ°å¤„ç†ç»“æœæ–‡ä»¶"
          echo "status=unknown" >> $GITHUB_OUTPUT
        fi
        
    - name: ä¸Šä¼ ç”Ÿæˆçš„æ–‡ç« 
      id: upload-artifacts
      uses: actions/upload-artifact@v4
      if: always()
      continue-on-error: true
      with:
        name: generated-articles-${{ github.run_number }}
        path: |
          generate_result.json
          *.log
        retention-days: 7
        compression-level: 1
        
    - name: ä¸Šä¼ é”™è¯¯æ—¥å¿—
      uses: actions/upload-artifact@v4
      if: failure()
      continue-on-error: true
      with:
        name: error-logs-${{ github.run_number }}
        path: logs/*/error_log.txt
        retention-days: 3
        compression-level: 1
        
    - name: å¤„ç†Artifactå­˜å‚¨é…é¢é”™è¯¯
      if: always()
      run: |
        echo "ğŸ“Š æ£€æŸ¥Artifactä¸Šä¼ çŠ¶æ€..."
        if [ "${{ steps.upload-artifacts.outcome }}" = "failure" ]; then
          echo "âš ï¸ Artifactä¸Šä¼ å¤±è´¥ï¼Œä½†è¿™ä¸å½±å“ä»»åŠ¡æ‰§è¡Œç»“æœ"
          echo "æ³¨æ„ï¼šArtifactå­˜å‚¨é…é¢é”™è¯¯ä¸ä¼šå½±å“å·¥ä½œæµçš„æˆåŠŸæ‰§è¡Œ"
          echo "æ–‡ç« ç”Ÿæˆå’Œæäº¤åˆ°ä»“åº“çš„åŠŸèƒ½ä»ç„¶æ­£å¸¸å·¥ä½œ"
        else
          echo "âœ… Artifactä¸Šä¼ æˆåŠŸ"
        fi
        
        # æ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶ä»¥å‡å°‘å­˜å‚¨ä½¿ç”¨
        echo "ğŸ§¹ æ¸…ç†æ—§çš„æ—¥å¿—æ–‡ä»¶..."
        find logs -name "*.log" -mtime +1 -delete 2>/dev/null || true
        find logs -name "error_log.txt" -mtime +7 -delete 2>/dev/null || true
        
    - name: æ¸…ç†ä¸å®Œæ•´çš„æ–‡ç« ç›®å½•å’Œä¸´æ—¶ä¸‹è½½æ–‡ä»¶å¤¹
      if: always()
      run: |
        echo "ğŸ§¹ æ¸…ç†æ²¡æœ‰README.mdæ–‡ä»¶çš„ä¸å®Œæ•´æ–‡ç« ç›®å½•..."
        
        # æŸ¥æ‰¾æ‰€æœ‰æ²¡æœ‰README.mdæ–‡ä»¶çš„æ–‡ç« ç›®å½•å¹¶åˆ é™¤
        find logs/backup -type d -name "images" | while read images_dir; do
          article_dir=$(dirname "$images_dir")
          if [ ! -f "$article_dir/README.md" ]; then
            echo "ğŸ—‘ï¸  åˆ é™¤ä¸å®Œæ•´çš„æ–‡ç« ç›®å½•: $article_dir"
            rm -rf "$article_dir"
          fi
        done
        
        # æ¸…ç†ç©ºçš„æ—¥æœŸç›®å½•
        find logs/backup -type d -empty -delete 2>/dev/null || true
        
        echo "ğŸ§¹ æ¸…ç†ä¸´æ—¶ä¸‹è½½æ–‡ä»¶å¤¹..."
        
        # æŸ¥æ‰¾å¹¶åˆ é™¤æ‰€æœ‰ä¸´æ—¶ä¸‹è½½æ–‡ä»¶å¤¹
        find logs -type d -name "temp_download" | while read temp_dir; do
          echo "ğŸ—‘ï¸  åˆ é™¤ä¸´æ—¶ä¸‹è½½æ–‡ä»¶å¤¹: $temp_dir"
          rm -rf "$temp_dir"
        done
        
        # æŸ¥æ‰¾å¹¶åˆ é™¤æ‰€æœ‰ä»¥å…³é”®è¯å‘½åçš„ä¸‹è½½æ–‡ä»¶å¤¹ï¼ˆbing-image-downloaderåˆ›å»ºçš„ï¼‰
        find logs -type d -name "*" | while read dir; do
          # æ£€æŸ¥æ˜¯å¦æ˜¯ä¸‹è½½æ–‡ä»¶å¤¹ï¼ˆåŒ…å«å›¾ç‰‡æ–‡ä»¶ä½†æ²¡æœ‰README.mdï¼‰
          if [ -d "$dir" ] && [ ! -f "$dir/README.md" ] && [ ! -f "$(dirname "$dir")/README.md" ]; then
            # æ£€æŸ¥æ˜¯å¦åŒ…å«å›¾ç‰‡æ–‡ä»¶
            if find "$dir" -name "*.jpg" -o -name "*.jpeg" -o -name "*.png" -o -name "*.gif" -o -name "*.webp" | head -1 | grep -q .; then
              echo "ğŸ—‘ï¸  åˆ é™¤ä¸´æ—¶ä¸‹è½½æ–‡ä»¶å¤¹: $dir"
              rm -rf "$dir"
            fi
          fi
        done
        
        echo "âœ… æ¸…ç†å®Œæˆ"
        
    - name: æäº¤ç”Ÿæˆçš„æ–‡ç« åˆ°ä»“åº“
      if: always()
      run: |
        # é…ç½®Gitç”¨æˆ·ä¿¡æ¯
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # å…ˆæ‹‰å–è¿œç¨‹æ›´æ”¹ï¼Œé¿å…æ¨é€å†²çª
        echo "ğŸ”„ æ‹‰å–è¿œç¨‹æ›´æ”¹..."
        git pull origin main --no-edit || {
          echo "âš ï¸ æ‹‰å–å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶æ‹‰å–..."
          git fetch origin main
          git reset --hard origin/main
        }
        
        # æ£€æŸ¥logsç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ·»åŠ ç”Ÿæˆçš„æ–‡ç« 
        if [ -d "logs" ] && [ "$(find logs -type f -name "*.md" | wc -l)" -gt 0 ]; then
          echo "ğŸ“ å‘ç°ç”Ÿæˆçš„æ–‡ç« ï¼Œæ·»åŠ åˆ°Git..."
          git add logs/
        else
          echo "ğŸ“ æ²¡æœ‰å‘ç°æ–°çš„æ–‡ç« æ–‡ä»¶ï¼Œè·³è¿‡Gitæ·»åŠ "
        fi
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
        if git diff --staged --quiet; then
          echo "æ²¡æœ‰æ–°çš„æ–‡ç« ç”Ÿæˆ"
        else
          # æäº¤å˜æ›´
          git commit -m "ğŸ¤– è‡ªåŠ¨ç”Ÿæˆæ–‡ç«  - å·¥ä½œæµ #${{ github.run_number }} [skip ci]"
          
          # æ¨é€åˆ°ä»“åº“ï¼Œä½¿ç”¨é‡è¯•æœºåˆ¶
          echo "ğŸ“¤ æ¨é€æ–‡ç« åˆ°ä»“åº“..."
          for i in {1..3}; do
            if git push origin main; then
              echo "âœ… æ–‡ç« å·²æˆåŠŸæäº¤åˆ°ä»“åº“"
              break
            else
              echo "âš ï¸ æ¨é€å¤±è´¥ï¼Œå°è¯•ç¬¬ $i æ¬¡é‡è¯•..."
              sleep 5
              # é‡æ–°æ‹‰å–å¹¶åˆå¹¶
              git pull origin main --no-edit || git reset --hard origin/main
            fi
          done
        fi
        
    - name: æ£€æŸ¥ç”Ÿæˆç»“æœ
      run: |
        echo "ğŸ“Š æ£€æŸ¥ç”Ÿæˆç»“æœ..."
        
        # ç»Ÿè®¡ç”Ÿæˆçš„æ–‡ä»¶æ•°é‡
        ARTICLE_COUNT=$(find logs -name "README.md" -type f | wc -l)
        echo "ç”Ÿæˆçš„æ–‡ç« æ•°é‡: $ARTICLE_COUNT"
        
        # æ£€æŸ¥é”™è¯¯æ—¥å¿—
        ERROR_LOG_FOUND=false
        for error_log in logs/*/error_log.txt; do
          if [ -f "$error_log" ]; then
            ERROR_COUNT=$(wc -l < "$error_log")
            echo "é”™è¯¯è®°å½•æ•°é‡: $ERROR_COUNT (æ¥è‡ª $error_log)"
            ERROR_LOG_FOUND=true
          fi
        done
        
        if [ "$ERROR_LOG_FOUND" = false ]; then
          echo "æ²¡æœ‰é”™è¯¯è®°å½•"
        fi
        
        # è¾“å‡ºæ–‡ä»¶ç»“æ„
        echo "ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„:"
        find logs -type f -name "*.md" | head -10
        
    - name: è¾“å‡ºå®Œæˆä¿¡æ¯
      if: always()
      run: |
        echo "ğŸ“ æ–‡ç« ç”Ÿæˆä»»åŠ¡å®Œæˆ"
        echo "ğŸ• æ‰§è¡Œæ—¶é—´: $(date)"
        echo "ğŸ“Š ç”Ÿæˆæ–‡ç« æ•°é‡: $ARTICLE_COUNT"
        echo "âŒ é”™è¯¯æ•°é‡: $ERROR_COUNT"
        echo "ğŸ”— å·¥ä½œæµé“¾æ¥: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
        
    - name: å¤„ç†æˆåŠŸ - æ¢å¤æ—¥å¸¸æ¨¡å¼
      if: steps.check-result.outputs.status == 'success'
      run: |
        echo "âœ… æ–‡ç« ç”ŸæˆæˆåŠŸå®Œæˆï¼"
        echo "ğŸ”„ æ¢å¤å·¥ä½œæµä¸ºæ—¥å¸¸æ¨¡å¼..."
        
        # è¿è¡Œè„šæœ¬æ¢å¤å·¥ä½œæµä¸ºæ—¥å¸¸æ¨¡å¼
        python update_workflow_schedule.py --type daily --workflow generate-articles --no-push
        
        echo "âœ… å·¥ä½œæµå·²æ¢å¤ä¸ºæ—¥å¸¸æ¨¡å¼"
        
    - name: æ¨é€æ¢å¤æ—¥å¸¸æ¨¡å¼çš„å·¥ä½œæµæ–‡ä»¶
      if: steps.check-result.outputs.status == 'success'
      run: |
        echo "ğŸ“¤ æ¨é€æ¢å¤æ—¥å¸¸æ¨¡å¼çš„å·¥ä½œæµæ–‡ä»¶..."
        
        # é…ç½®Gitç”¨æˆ·ä¿¡æ¯
        git config user.name "github-actions"
        git config user.email "github-actions@users.noreply.github.com"
        
        # å…ˆæ‹‰å–è¿œç¨‹æ›´æ”¹ï¼Œé¿å…æ¨é€å†²çª
        echo "ğŸ”„ æ‹‰å–è¿œç¨‹æ›´æ”¹..."
        git pull origin main --no-edit || {
          echo "âš ï¸ æ‹‰å–å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶æ‹‰å–..."
          git fetch origin main
          git reset --hard origin/main
        }
        
        # æ·»åŠ å·¥ä½œæµæ–‡ä»¶
        git add .github/workflows/generate-articles.yml
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
        if git diff --staged --quiet; then
          echo "ğŸ“ å·¥ä½œæµæ–‡ä»¶æœªæ›´æ”¹"
        else
          # æäº¤å˜æ›´
          git commit -m "æ¢å¤å·¥ä½œæµä¸ºæ—¥å¸¸æ¨¡å¼"
          
          # æ¨é€åˆ°ä»“åº“ï¼Œä½¿ç”¨é‡è¯•æœºåˆ¶
          echo "ğŸ“¤ æ¨é€å·¥ä½œæµæ–‡ä»¶åˆ°ä»“åº“..."
          for i in {1..3}; do
            if git push https://${{ secrets.USERNAME }}:${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git HEAD:main; then
              echo "âœ… å·¥ä½œæµæ–‡ä»¶å·²æˆåŠŸæ¨é€"
              break
            else
              echo "âš ï¸ æ¨é€å¤±è´¥ï¼Œå°è¯•ç¬¬ $i æ¬¡é‡è¯•..."
              sleep 5
              # é‡æ–°æ‹‰å–å¹¶åˆå¹¶
              git pull origin main --no-edit || git reset --hard origin/main
            fi
          done
        fi
        
    - name: å¤„ç†å¤±è´¥ - æ›´æ–°å·¥ä½œæµä¸ºé‡è¯•æ¨¡å¼å¹¶æ¨é€
      if: always() && (steps.check-result.outputs.status == 'error' || steps.check-result.outputs.status == 'circuit_breaker' || steps.check-result.outputs.status == 'timeout' || (steps.check-result.outputs.status == 'unknown' && steps.generate-task.outcome == 'failure')) && steps.check-result.outputs.status != 'cancelled'
      run: |
        echo "âš ï¸ æ–‡ç« ç”Ÿæˆä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼"
        echo "ğŸ”„ è°ƒæ•´å·¥ä½œæµä¸ºé‡è¯•æ¨¡å¼ï¼ˆ30åˆ†é’Ÿåé‡è¯•ï¼‰..."
        
        # é…ç½®Gitç”¨æˆ·ä¿¡æ¯
        git config user.name "github-actions"
        git config user.email "github-actions@users.noreply.github.com"
        
        # å…ˆæ‹‰å–è¿œç¨‹æ›´æ”¹ï¼Œé¿å…æ¨é€å†²çª
        echo "ğŸ”„ æ‹‰å–è¿œç¨‹æ›´æ”¹..."
        git pull origin main --no-edit || {
          echo "âš ï¸ æ‹‰å–å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶æ‹‰å–..."
          git fetch origin main
          git reset --hard origin/main
        }
        
        # è¿è¡Œè„šæœ¬æ›´æ–°å·¥ä½œæµæ–‡ä»¶
        echo "ğŸ”§ æ›´æ–°å·¥ä½œæµæ–‡ä»¶ä¸ºé‡è¯•æ¨¡å¼..."
        python update_workflow_schedule.py --type retry --delay 30 --workflow generate-articles --no-push
        
        # æ·»åŠ å·¥ä½œæµæ–‡ä»¶
        git add .github/workflows/generate-articles.yml
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
        if git diff --staged --quiet; then
          echo "ğŸ“ å·¥ä½œæµæ–‡ä»¶æœªæ›´æ”¹ï¼Œå¯èƒ½å·²ç»æ˜¯æœ€æ–°çŠ¶æ€"
        else
          # æäº¤å˜æ›´
          git commit -m "è‡ªåŠ¨è°ƒæ•´å·¥ä½œæµä¸ºé‡è¯•æ¨¡å¼ (30åˆ†é’Ÿåé‡è¯•)"
          
          # æ¨é€åˆ°ä»“åº“ï¼Œä½¿ç”¨é‡è¯•æœºåˆ¶
          echo "ğŸ“¤ æ¨é€å·¥ä½œæµæ–‡ä»¶åˆ°ä»“åº“..."
          for i in {1..3}; do
            if git push https://${{ secrets.USERNAME }}:${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git HEAD:main; then
              echo "âœ… å·¥ä½œæµæ–‡ä»¶å·²æˆåŠŸæ¨é€"
              break
            else
              echo "âš ï¸ æ¨é€å¤±è´¥ï¼Œå°è¯•ç¬¬ $i æ¬¡é‡è¯•..."
              sleep 5
              # é‡æ–°æ‹‰å–å¹¶åˆå¹¶
              git pull origin main --no-edit || git reset --hard origin/main
            fi
          done
        fi
        
        echo "âœ… é‡è¯•æ¨¡å¼è®¾ç½®å®Œæˆ"
        
    - name: å‘é€æˆåŠŸé€šçŸ¥
      if: steps.check-result.outputs.status == 'success'
      run: |
        echo "ğŸ‰ æ–‡ç« ç”ŸæˆæˆåŠŸå®Œæˆï¼"
        echo "è¿è¡Œç¼–å·: ${{ github.run_number }}"
        echo "å®Œæˆæ—¶é—´: $(date)"
        echo "éœ€è¦å›¾ç‰‡: ${{ github.event.inputs.need_images || 'true' }}"
        echo "æ¯ç«™æ–‡ç« æ•°: ${{ github.event.inputs.articles_per_site || 'ä½¿ç”¨é»˜è®¤å€¼' }}"
        echo "âœ… å·¥ä½œæµå·²è‡ªåŠ¨æ¢å¤ä¸ºæ—¥å¸¸æ¨¡å¼"
        
    - name: å¤„ç†Artifactä¸Šä¼ å¤±è´¥ä½†ä»»åŠ¡æˆåŠŸçš„æƒ…å†µ
      if: steps.check-result.outputs.status == 'success' && steps.upload-artifacts.outcome == 'failure'
      run: |
        echo "âœ… æ–‡ç« ç”Ÿæˆä»»åŠ¡æˆåŠŸå®Œæˆï¼"
        echo "âš ï¸ ä½†Artifactä¸Šä¼ å¤±è´¥ï¼ˆå­˜å‚¨é…é¢é—®é¢˜ï¼‰"
        echo "ğŸ“Š è¿™ä¸ä¼šå½±å“ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œå·¥ä½œæµå°†æ­£å¸¸æ¢å¤ä¸ºæ—¥å¸¸æ¨¡å¼"
        echo "ğŸ”„ å·¥ä½œæµå·²è‡ªåŠ¨æ¢å¤ä¸ºæ—¥å¸¸æ¨¡å¼"
        
    - name: å‘é€å¤±è´¥é€šçŸ¥
      if: (steps.check-result.outputs.status == 'error' || steps.check-result.outputs.status == 'circuit_breaker' || steps.check-result.outputs.status == 'unknown') && steps.generate-task.outcome == 'failure'
      run: |
        if [ "${{ steps.check-result.outputs.status }}" = "circuit_breaker" ]; then
          echo "ğŸ”¥ æ–‡ç« ç”Ÿæˆè§¦å‘ç†”æ–­æœºåˆ¶ï¼"
          echo "è¿è¡Œç¼–å·: ${{ github.run_number }}"
          echo "è§¦å‘æ—¶é—´: $(date)"
          echo "ç†”æ–­ä¿¡æ¯: ${{ steps.check-result.outputs.error_message }}"
          echo "ğŸ• å·²å®‰æ’30åˆ†é’Ÿåé‡è¯•"
        else
          echo "âŒ æ–‡ç« ç”Ÿæˆå¤±è´¥ï¼"
          echo "è¿è¡Œç¼–å·: ${{ github.run_number }}"
          echo "å¤±è´¥æ—¶é—´: $(date)"
          echo "é”™è¯¯ä¿¡æ¯: ${{ steps.check-result.outputs.error_message }}"
          echo "ğŸ• å·²å®‰æ’30åˆ†é’Ÿåé‡è¯•"
        fi

    - name: å¤„ç†å–æ¶ˆ - ä¸é‡è¯•
      if: cancelled()
      run: |
        echo "â° å·¥ä½œæµè¢«æ‰‹åŠ¨å–æ¶ˆï¼"
        echo "è¿è¡Œç¼–å·: ${{ github.run_number }}"
        echo "å–æ¶ˆæ—¶é—´: $(date)"
        echo "âš ï¸ æ‰‹åŠ¨å–æ¶ˆä¸ä¼šè§¦å‘é‡è¯•ï¼Œå·¥ä½œæµå°†ä¿æŒå½“å‰çŠ¶æ€"

    - name: å‘é€å–æ¶ˆé€šçŸ¥
      if: cancelled()
      run: |
        if [ -f ".timeout_inferred" ]; then
          echo "â° å·¥ä½œæµå› æ¥è¿‘è¶…æ—¶è€Œè¢«å–æ¶ˆï¼ˆæ¨æµ‹ï¼‰ï¼"
          echo "è¿è¡Œç¼–å·: ${{ github.run_number }}"
          echo "æ—¶é—´: $(date)"
          echo "ğŸ• å°†æŒ‰ç…§é‡è¯•ç­–ç•¥å¤„ç†"
        else
          echo "â° å·¥ä½œæµè¢«æ‰‹åŠ¨å–æ¶ˆï¼"
          echo "è¿è¡Œç¼–å·: ${{ github.run_number }}"
          echo "å–æ¶ˆæ—¶é—´: $(date)"
          echo "âš ï¸ æ‰‹åŠ¨å–æ¶ˆä¸ä¼šè§¦å‘é‡è¯•"
        fi

    - name: å¤„ç†è¶…æ—¶å–æ¶ˆ - è®¾ç½®é‡è¯•æ¨¡å¼
      if: cancelled()
      run: |
        if [ -f ".timeout_inferred" ]; then
          echo "ğŸ”„ æ£€æµ‹åˆ°è¶…æ—¶å–æ¶ˆï¼ˆæ¨æµ‹ï¼‰ï¼Œæ›´æ–°å·¥ä½œæµä¸ºé‡è¯•æ¨¡å¼ï¼ˆ30åˆ†é’Ÿåé‡è¯•ï¼‰..."

          # é…ç½®Gitç”¨æˆ·ä¿¡æ¯
          git config user.name "github-actions"
          git config user.email "github-actions@users.noreply.github.com"

          # å…ˆæ‹‰å–è¿œç¨‹æ›´æ”¹ï¼Œé¿å…æ¨é€å†²çª
          echo "ğŸ”„ æ‹‰å–è¿œç¨‹æ›´æ”¹..."
          git pull origin main --no-edit || {
            echo "âš ï¸ æ‹‰å–å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶æ‹‰å–..."
            git fetch origin main
            git reset --hard origin/main
          }

          # è¿è¡Œè„šæœ¬æ›´æ–°å·¥ä½œæµæ–‡ä»¶
          echo "ğŸ”§ æ›´æ–°å·¥ä½œæµæ–‡ä»¶ä¸ºé‡è¯•æ¨¡å¼..."
          python update_workflow_schedule.py --type retry --delay 30 --workflow generate-articles --no-push

          # æ·»åŠ å¹¶æäº¤å·¥ä½œæµæ–‡ä»¶
          git add .github/workflows/generate-articles.yml
          if git diff --staged --quiet; then
            echo "ğŸ“ å·¥ä½œæµæ–‡ä»¶æœªæ›´æ”¹ï¼Œå¯èƒ½å·²ç»æ˜¯æœ€æ–°çŠ¶æ€"
          else
            git commit -m "å› è¶…æ—¶å–æ¶ˆæ¨æµ‹ï¼Œè‡ªåŠ¨è°ƒæ•´å·¥ä½œæµä¸ºé‡è¯•æ¨¡å¼ (30åˆ†é’Ÿåé‡è¯•)"
            echo "ğŸ“¤ æ¨é€å·¥ä½œæµæ–‡ä»¶åˆ°ä»“åº“..."
            for i in {1..3}; do
              if git push https://${{ secrets.USERNAME }}:${{ secrets.GH_PAT }}@github.com/${{ github.repository }}.git HEAD:main; then
                echo "âœ… å·¥ä½œæµæ–‡ä»¶å·²æˆåŠŸæ¨é€"
                break
              else
                echo "âš ï¸ æ¨é€å¤±è´¥ï¼Œå°è¯•ç¬¬ $i æ¬¡é‡è¯•..."
                sleep 5
                git pull origin main --no-edit || git reset --hard origin/main
              fi
            done
          fi
          echo "âœ… å·²ä¸ºè¶…æ—¶å–æ¶ˆè®¾ç½®é‡è¯•æ¨¡å¼"
        else
          echo "ğŸ›‘ æ£€æµ‹åˆ°æ‰‹åŠ¨å–æ¶ˆï¼Œä¸è®¾ç½®é‡è¯•æ¨¡å¼"
        fi

